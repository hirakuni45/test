scanf に似た仕様で数値変換を実現する C++ クラス
=========

## 概要
 C++ では、C 言語で一般的な可変引数を扱う仕様は使わない文化があります。   
   
 一番の問題は、引数の引渡しはスタックを経由する点、又、スタックに引数が何個格納   
 されているのか判らない点です、これによりスタックをオーバーロードさせ、システム   
 に悪影響を与える事が出来てしまいます。   
   
 代表的な実装は「printf」関数です。   
 コンパイラはフォーマット文を解析して、引数の整合性をチェックしますが、完全には   
 チェックできません。   
 一方、「printf」は優れた柔軟性をもたらし、文字、数値を扱う事をたやすくします。   
   
 boost には、printf の柔軟性と、安全性を考慮した、format.hpp があります。   
 ※％オペレーターのオーバーロード機構を利用して、複数の引数を受け取る事ができます。   
 ※boost::format は優れた実装ですが、組み込みマイコンでは、iostream に依存していて   
 問題があります（iostream を取り込むと、容量が肥大化します）、その為、組み込みマイ   
コン向けの軽量な「format.hpp」を実装しています。   
   
 同じように、printf とは逆の動作をする scanf も安全性においては printf と同じ問題   
 を抱えています。   
 そこで、format.hpp の仕組みをまねて、input クラスを実装しました。   
   
## 仕様
 - 基本的な仕様
   ２進数、８進数、１０進数、１６進数、浮動小数点などを受け取る事が出来ます。   
   
   名前空間は「utils」にあります。
   
   文字列の受け取りは、ファンクタを定義して、テンプレートパラメーターとします。   
   ※標準的なファンクタ「def_chainp」クラスが定義されており、以下のように   
   typedef されています。   
```
   	typedef basic_input<def_chainp> input;
```
   標準のファンクタは、標準入力から文字列を受け取りますが、キャラクター型ポインター   
   を定義する事ができ、「sscanf」のように機能します。
   
   組み込みマイコンで使う事を考えて、エラーに関する処理では、「例外」を送出しません。
   入力変換時に起こったエラーは、エラー種別として取得する事ができます。
   
   非常に単純な正規表現のみを受け入れ、独自の仕様として拡張してあります。   
   
## 使い方
標準入力から、変数「a」に１０進数を受け取ります。   
※標準入力から受け取る場合、入力の終端は、'\n'（改行）とします。   
```
   int a;
   utils::input("%d") % a;
```
   ※以下のように変換ステートを受け取る事が出来るので、変換出来ない場合を検出できます。   
```
   int a;
   if((utils::input("%d") % a).state()) {
       // OK
   } else {
       // NG
   }
```
   受け取り時、どんなエラーがあったのかを判断したい場合、以下のようにエラー種別を取得   
   する事ができます。
```
   int a;
   auto err = (utils::input("%d") % a).get_error();
   if(err == utils::input::error::none) {
       // OK
   } else {
       // NG: 「err」種別により、相当する処理
   }
```
   
※エラー種別は：
```
    none,           ///< エラー無し
    cha_sets,       ///< 文字セットの不一致
    partition,      ///< 仕切りキャラクターの不一致
    input_type,     ///< 無効な入力タイプ
    not_integer,    ///< 整数の不一致
    not_float,      ///< 浮動小数点の不一致
    terminate,      ///< 終端文字の不一致
```
   
文字列から受け取る場合は、以下のようにします。   
※第二引数が省略された場合、上の例のように、標準入力となります。
```
   int a;
   static const char* inp = { "1234" };
   utils::input("%d", inp) % a;
```

  
---
      
License
----

MIT
